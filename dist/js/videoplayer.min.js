const video=document.getElementById("video"),videoControls=document.getElementById("video-controls"),playButton=document.getElementById("play"),playbackIcons=document.querySelectorAll(".playback-icons use"),timeElapsed=document.getElementById("time-elapsed"),duration=document.getElementById("duration"),progressBar=document.getElementById("progress-bar"),seek=document.getElementById("seek"),seekTooltip=document.getElementById("seek-tooltip"),volumeButton=document.getElementById("volume-button"),volumeIcons=document.querySelectorAll(".volume-button use"),volumeMute=document.querySelector('use[href="#volume-mute"]'),volumeLow=document.querySelector('use[href="#volume-low"]'),volumeHigh=document.querySelector('use[href="#volume-high"]'),volume=document.getElementById("volume"),playbackAnimation=document.getElementById("playback-animation"),fullscreenButton=document.getElementById("fullscreen-button"),videoContainer=document.getElementById("video-container"),fullscreenIcons=fullscreenButton.querySelectorAll("use"),pipButton=document.getElementById("pip-button"),videoWorks=!!document.createElement("video").canPlayType;function togglePlay(){video.paused||video.ended?video.play():video.pause()}function updatePlayButton(){playbackIcons.forEach((e=>e.classList.toggle("hidden"))),video.paused?playButton.setAttribute("data-title","Play (k)"):playButton.setAttribute("data-title","Pause (k)")}function formatTime(e){const t=new Date(1e3*e).toISOString().substr(11,8);return{minutes:t.substr(3,2),seconds:t.substr(6,2)}}function initializeVideo(){const e=Math.round(video.duration);seek.setAttribute("max",e),progressBar.setAttribute("max",e);const t=formatTime(e);duration.innerText=`${t.minutes}:${t.seconds}`,duration.setAttribute("datetime",`${t.minutes}m ${t.seconds}s`)}function updateTimeElapsed(){const e=formatTime(Math.round(video.currentTime));timeElapsed.innerText=`${e.minutes}:${e.seconds}`,timeElapsed.setAttribute("datetime",`${e.minutes}m ${e.seconds}s`)}function updateProgress(){seek.value=Math.floor(video.currentTime),progressBar.value=Math.floor(video.currentTime)}function updateSeekTooltip(e){const t=Math.round(e.offsetX/e.target.clientWidth*parseInt(e.target.getAttribute("max"),10));seek.setAttribute("data-seek",t);const o=formatTime(t);seekTooltip.textContent=`${o.minutes}:${o.seconds}`;const n=video.getBoundingClientRect();seekTooltip.style.left=e.pageX-n.left+"px"}function skipAhead(e){const t=e.target.dataset.seek?e.target.dataset.seek:e.target.value;video.currentTime=t,progressBar.value=t,seek.value=t}function updateVolume(){video.muted&&(video.muted=!1),video.volume=volume.value}function updateVolumeIcon(){volumeIcons.forEach((e=>{e.classList.add("hidden")})),volumeButton.setAttribute("data-title","Mute (m)"),video.muted||0===video.volume?(volumeMute.classList.remove("hidden"),volumeButton.setAttribute("data-title","Unmute (m)")):video.volume>0&&video.volume<=.5?volumeLow.classList.remove("hidden"):volumeHigh.classList.remove("hidden")}function toggleMute(){video.muted=!video.muted,video.muted?(volume.setAttribute("data-volume",volume.value),volume.value=0):volume.value=volume.dataset.volume}function animatePlayback(){playbackAnimation.animate([{opacity:1,transform:"scale(1)"},{opacity:0,transform:"scale(1.3)"}],{duration:500})}function toggleFullScreen(){document.fullscreenElement?document.exitFullscreen():videoContainer.requestFullscreen()}function updateFullscreenButton(){fullscreenIcons.forEach((e=>e.classList.toggle("hidden"))),document.fullscreenElement?fullscreenButton.setAttribute("data-title","Exit full screen (f)"):fullscreenButton.setAttribute("data-title","Full screen (f)")}async function togglePip(){try{video!==document.pictureInPictureElement?(pipButton.disabled=!0,await video.requestPictureInPicture()):await document.exitPictureInPicture()}catch(e){console.error(e)}finally{pipButton.disabled=!1}}function hideControls(){video.paused||videoControls.classList.add("hide")}function showControls(){videoControls.classList.remove("hide")}function keyboardShortcuts(e){const{key:t}=e;switch(t){case"k":togglePlay(),animatePlayback(),video.paused?showControls():setTimeout((()=>{hideControls()}),2e3);break;case"m":toggleMute();break;case"f":toggleFullScreen();break;case"p":togglePip()}}videoWorks&&(video.controls=!1,videoControls.classList.remove("hidden")),playButton.addEventListener("click",togglePlay),video.addEventListener("play",updatePlayButton),video.addEventListener("pause",updatePlayButton),video.addEventListener("loadedmetadata",initializeVideo),video.addEventListener("timeupdate",updateTimeElapsed),video.addEventListener("timeupdate",updateProgress),video.addEventListener("volumechange",updateVolumeIcon),video.addEventListener("click",togglePlay),video.addEventListener("click",animatePlayback),video.addEventListener("mouseenter",showControls),video.addEventListener("mouseleave",hideControls),videoControls.addEventListener("mouseenter",showControls),videoControls.addEventListener("mouseleave",hideControls),seek.addEventListener("mousemove",updateSeekTooltip),seek.addEventListener("input",skipAhead),volume.addEventListener("input",updateVolume),volumeButton.addEventListener("click",toggleMute),fullscreenButton.addEventListener("click",toggleFullScreen),videoContainer.addEventListener("fullscreenchange",updateFullscreenButton),pipButton.addEventListener("click",togglePip),document.addEventListener("DOMContentLoaded",(()=>{"pictureInPictureEnabled"in document||pipButton.classList.add("hidden")})),document.addEventListener("keyup",keyboardShortcuts);